<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HomeLab Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='base.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='dashboard.css') }}"
    />
    <style>
      :root {
        --primary: {
            {
            config.colors.primary
          }
        }

        ;

        --primary-rgb: {
            {
            config.colors.primary_rgb
          }
        }

        ;

        --primary-hover: {
            {
            config.colors.primary_hover
          }
        }

        ;

        --primary-hover-rgb: {
            {
            config.colors.primary_hover_rgb
          }
        }

        ;

        --background-dark: {
            {
            config.colors.background_dark
          }
        }

        ;

        --background-dark-rgb: {
            {
            config.colors.background_dark_rgb
          }
        }

        ;

        --background-secondary: {
            {
            config.colors.background_secondary
          }
        }

        ;

        --background-secondary-rgb: {
            {
            config.colors.background_secondary_rgb
          }
        }

        ;

        --text-white: {
            {
            config.colors.text_white
          }
        }

        ;

        --text-white-rgb: {
            {
            config.colors.text_white_rgb
          }
        }

        ;

        --text-light: {
            {
            config.colors.text_light
          }
        }

        ;

        --text-medium: {
            {
            config.colors.text_medium
          }
        }

        ;

        --text-gray: {
            {
            config.colors.text_gray
          }
        }

        ;

        --text-dark-gray: {
            {
            config.colors.text_dark_gray
          }
        }

        ;

        --neutral-rgb: {
            {
            config.colors.hero_gradial_rgb
          }
        }

        ;
      }
    </style>
  </head>

  <body>
    <nav class="navbar">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/dashboard">Dashboard</a></li>
        <li><a href="/logout">Logout</a></li>
      </ul>
    </nav>

    <main class="dashboard-content">
      <header class="dashboard-header">
        <h1>Welcome to {{ config.home.title }}, {{ name }}!</h1>
        <p>Track your projects and manage your orders.</p>
      </header>

      <section class="projects-section">
        <h2>Your Projects</h2>
        <div class="carousel">
          <div class="add-card" onclick="openModal()">
            <div class="add-icon">+</div>
            <p>Add New Project</p>
          </div>
          {% for project in projects %}
          <div class="project-card">
            <div class="project-header">
              <h3>{{ project[1] }}</h3>
              <span class="project-status status-pending"
                >{{ project[6] }}</span
              >
            </div>
            <p class="project-description">{{ project[2] }}</p>
            <div class="project-footer">
              <span class="project-hours">{{ project[8] }} logged</span>
              <a
                href="#"
                class="btn btn-small"
                onclick="openEditModal({{ project[0] }})"
                >Edit</a
              >
            </div>
          </div>
          {% endfor %}
        </div>
      </section>

      <!-- <section class="orders-section">
        <h2>Your Orders</h2>
        <div class="carousel">
          <div class="add-card">
            <div class="add-icon">+</div>
            <p>Add New Order</p>
          </div>
          <div class="order-card">
            <div class="order-header">
              <h3>32GB USB Flash Drive</h3>
              <span class="order-status status-pending">Pending</span>
            </div>
            <p class="order-description">
              Perfect for booting and installing OS!
            </p>
            <div class="order-footer">
              <span class="order-hours">2 hours spent</span>
            </div>
          </div>
          <div class="order-card">
            <div class="order-header">
              <h3>Cable Management Kit</h3>
              <span class="order-status status-shipped">Shipped</span>
            </div>
            <p class="order-description">
              Keep your setup organized and clean.
            </p>
            <div class="order-footer">
              <span class="order-hours">3 hours spent</span>
            </div>
          </div>
        </div>
      </section> -->
    </main>

    <div id="addProjectModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Add New Project</h2>
        <form id="addProjectForm" action="/create_project" method="post">
          <label for="title">Title *</label>
          <input type="text" id="title" name="title" required />

          <label for="description">Description *</label>
          <textarea id="description" name="description" required></textarea>

          <label for="demoLink">Demo Link</label>
          <input type="url" id="demoLink" name="demoLink" />

          <label for="githubLink">GitHub Link</label>
          <input type="url" id="githubLink" name="githubLink" />

          <label for="hours">Hours *</label>
          <select id="hours" name="hours" required>
            <option value="">Select hours</option>
            {% for project in hackatime.data.projects %}
            <option value="{{ project.name }}">
              {{ project.name }} ({{ project.text }})
            </option>
            {% endfor %}
          </select>

          <button type="submit" class="btn-submit">Add Project</button>
        </form>
      </div>
    </div>

    <div id="editProjectModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <h2>Edit Project</h2>
        <form id="editProjectForm" action="/edit_project" method="post">
          <input type="hidden" name="project_id" id="editProjectId" />
          <label for="editTitle">Title *</label>
          <input type="text" id="editTitle" name="title" required />

          <label for="editDescription">Description *</label>
          <textarea id="editDescription" name="description" required></textarea>

          <label for="editDemoLink">Demo Link</label>
          <input type="url" id="editDemoLink" name="demoLink" />

          <label for="editGithubLink">GitHub Link</label>
          <input type="url" id="editGithubLink" name="githubLink" />

          <label for="editHours">Hours *</label>
          <select id="editHours" name="hours" required>
            <option value="">Select hours</option>
            {% for project in hackatime.data.projects %}
            <option value="{{ project.name }}">
              {{ project.name }} ({{ project.text }})
            </option>
            {% endfor %}
          </select>

          <button type="submit" class="btn-submit">Update Project</button>
        </form>
      </div>
    </div>

    <script>
      function openModal() {
        const modal = document.getElementById("addProjectModal");
        modal.style.display = "block";
        setTimeout(() => {
          modal.style.opacity = "1";
          modal.style.visibility = "visible";
        }, 10);
      }

      function closeModal() {
        const modal = document.getElementById("addProjectModal");
        modal.style.opacity = "0";
        modal.style.visibility = "hidden";
        setTimeout(() => {
          modal.style.display = "none";
        }, 300);
        document.getElementById("addProjectForm").reset();
      }

      window.onclick = function (event) {
        const modal = document.getElementById("addProjectModal");
        if (event.target === modal) {
          closeModal();
        }
      };


      const projects = {{ projects | tojson }};

      function openEditModal(projectId) {
        const project = projects.find(p => p[0] === projectId);
        if (!project) return;

        document.getElementById('editProjectId').value = project[0];
        document.getElementById('editTitle').value = project[1];
        document.getElementById('editDescription').value = project[2];
        document.getElementById('editDemoLink').value = project[3] || '';
        document.getElementById('editGithubLink').value = project[4] || '';
        document.getElementById('editHours').value = project[5];

        const modal = document.getElementById("editProjectModal");
        modal.style.display = "block";
        setTimeout(() => {
          modal.style.opacity = "1";
          modal.style.visibility = "visible";
        }, 10);
      }

      function closeEditModal() {
        const modal = document.getElementById("editProjectModal");
        modal.style.opacity = "0";
        modal.style.visibility = "hidden";
        setTimeout(() => {
          modal.style.display = "none";
        }, 300);
        document.getElementById("editProjectForm").reset();
      }

      window.onclick = function (event) {
        const addModal = document.getElementById("addProjectModal");
        const editModal = document.getElementById("editProjectModal");
        if (event.target === addModal) {
          closeModal();
        }
        if (event.target === editModal) {
          closeEditModal();
        }
      };
    </script>
  </body>
</html>
