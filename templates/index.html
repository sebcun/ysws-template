<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HomeLab</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='base.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='faqs.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='rewards.css') }}"
    />
  </head>
  <body>
    <a href="https://hackclub.com" target="_blank">
      <img
        src="{{ url_for('static', filename='flag-orpheus-left.png') }}"
        alt="Hack Club Flag"
        class="hack-club-flag"
      />
    </a>
    <section class="hero">
      <div class="hero-content">
        <h1>{{ config.home.title }}</h1>
        <p>{{ config.home.description }}</p>
        <div class="hero-buttons">
          <a href="#rewards" class="btn btn-secondary">Rewards</a>

          {% if config.mode == "rsvp" %}
          <a
            href="{{ config.rsvp }}"
            class="btn btn-primary"
            target="_blank"
            rel="noopener"
            >RSVP</a
          >
          {% elif config.mode == "active" %}
          <a href="/dashboard" class="btn btn-primary">Get Started</a>
          {% endif %}
          <a href="#faqs" class="btn btn-secondary">FAQs</a>
        </div>
      </div>
    </section>

    <section class="faq-section" id="faqs">
      <h2 class="section-title">Frequently Asked Questions</h2>
      <div class="faq-list">
        {% for question, answer in config.faqs.items() %}
        <div class="faq-card fade-in-element">
          <button
            class="faq-question"
            onclick="toggleFAQ(this)"
            aria-expanded="false"
          >
            <span>{{ question }}</span>
            <i class="fa-solid fa-chevron-down"></i>
          </button>
          <div class="faq-answer">
            <p>{{ answer | replace('\n', '<br />') | safe }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>

    <section class="rewards-section" id="rewards">
      <div class="rewards-container">
        <h2 class="section-title">Rewards</h2>

        <div class="shop-controls">
          <div class="search-container">
            <input
              type="text"
              id="search-input"
              placeholder="Search for items..."
              oninput="searchItems()"
            />
          </div>
          <div class="sort-container">
            <div class="sort-label-wrapper">
              <i class="fa-solid fa-filter"></i>
              <label for="sort-select">Sort by hours:</label>
            </div>
            <select id="sort-select" onchange="sortRewards()">
              <option value="asc">Low to High</option>
              <option value="desc">High to Low</option>
            </select>
          </div>
        </div>

        <div class="shop-grid" id="shop-grid">
          {% for reward in config.rewards %}
          <a href="{{ reward.link }}" target="_blank" class="shop-card-link">
            <div class="shop-card">
              <div class="shop-card-image">
                <img
                  src="{{ url_for('static', filename=reward.image) }}"
                  alt="{{ reward.title }}"
                />
              </div>
              <div class="shop-card-content">
                <h3 class="shop-card-title">{{ reward.title }}</h3>
                <p class="shop-card-description">{{ reward.description }}</p>
                <div class="shop-card-footer">
                  <div class="shop-card-hours">{{ reward.hours }} hours</div>
                </div>
              </div>
            </div>
          </a>
          {% endfor %}
        </div>
      </div>
    </section>

    <footer class="footer">
      <p>
        This website is
        <a href="{{ config.github }}" target="_blank">open source!</a>
      </p>
      <p>
        This program is supported by
        <a href="https://hackclub.com" target="_blank">HackClub.</a>
      </p>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const grid = document.getElementById("shop-grid");
        if (grid) {
          const initialCards = Array.from(grid.children);
          const observerOptions = {
            threshold: 0.1,
            rootMargin: "0px 0px -50px 0px",
          };

          const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
              if (entry.isIntersecting) {
                setTimeout(() => {
                  entry.target.classList.add("fade-in");
                }, index * 50);
                observer.unobserve(entry.target);
              }
            });
          }, observerOptions);

          initialCards.forEach((card) => {
            card.classList.add("fade-in-element");
            observer.observe(card);
          });

          const getHours = (card) => {
            const hoursText = card.querySelector(".shop-card-hours").innerText;
            return parseInt(hoursText);
          };
          const getCardText = (card) => {
            const title = card
              .querySelector(".shop-card-title")
              .innerText.toLowerCase();
            const description = card
              .querySelector(".shop-card-description")
              .innerText.toLowerCase();
            return title + " " + description;
          };

          window.searchItems = function () {
            const searchInput = document.getElementById("search-input");
            const searchTerm = searchInput.value.toLowerCase();
            const allCards = Array.from(grid.children);

            allCards.forEach((card) => {
              const cardText = getCardText(card);
              if (cardText.includes(searchTerm)) {
                card.style.display = "block";
                card.classList.add("search-visible");
              } else {
                card.style.display = "none";
                card.classList.remove("search-visible");
              }
            });
          };

          window.sortRewards = function () {
            const select = document.getElementById("sort-select");
            const sortValue = select.value;
            const currentCards = Array.from(grid.children).filter(
              (card) => card.style.display !== "none"
            );
            const allCards = Array.from(grid.children);
            allCards.sort((a, b) => {
              const aHours = getHours(a);
              const bHours = getHours(b);

              if (sortValue === "asc") {
                return aHours - bHours;
              } else {
                return bHours - aHours;
              }
            });

            grid.innerHTML = "";
            allCards.forEach((card) => grid.appendChild(card));
          };
          sortRewards();
        }

        const faqList = document.querySelector(".faq-list");
        if (faqList) {
          const faqCards = Array.from(faqList.children);
          const faqObserver = new IntersectionObserver(
            (entries) => {
              entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                  setTimeout(() => {
                    entry.target.classList.add("fade-in");
                  }, index * 50);
                  faqObserver.unobserve(entry.target);
                }
              });
            },
            {
              threshold: 0.1,
              rootMargin: "0px 0px -50px 0px",
            }
          );

          faqCards.forEach((card) => {
            card.classList.add("fade-in-element");
            faqObserver.observe(card);
          });
        }

        window.toggleFAQ = function (button) {
          const card = button.parentElement;
          const isOpen = card.classList.contains("open");
          button.setAttribute("aria-expanded", !isOpen);
          card.classList.toggle("open");
        };
      });
    </script>
  </body>
</html>
